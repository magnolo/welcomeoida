{"version":3,"sources":["map.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"map.js","sourcesContent":["$(function() {\n  //define variables\n  $.datas = {\n    map: null,\n    layer: null,\n    layers: {\n      heat: null,\n      base: null,\n      markers: null\n    },\n    icons: {\n      base: L.divIcon({\n        className: 'baseIcon'\n      }),\n      event: L.icon({\n        iconUrl: '/images/markers/bubble.png',\n        iconSize: [40, 33],\n        iconAnchor: [20, 33],\n        popupAnchor: [0, -20],\n        //shadowUrl: '/images/markers/bubble_shadow.png',\n        //shadowRetinaUrl: 'my-icon-shadow@2x.png',\n        //shadowSize: [40, 33],\n        //shadowAnchor: [20, 33]\n      }),\n      human: L.icon({\n        iconUrl: '/images/markers/ball.png',\n        iconSize: [12, 12],\n        iconAnchor: [6, 6],\n        //popupAnchor: [0, -20],\n        //shadowUrl: 'my-icon-shadow.png',\n        //shadowRetinaUrl: 'my-icon-shadow@2x.png',\n        //shadowSize: [68, 95],\n        //shadowAnchor: [22, 94]\n      })\n    },\n    newPoint: {\n      address: null,\n      marker: null\n    },\n    newImage: null,\n    partnerImage:null\n  }\n  var newHuman = {\n    name: '',\n    email: '',\n    address: null\n  };\n  var newEvent = {\n    name: '',\n    email: '',\n    address: null\n  };\n  var newPartner = {\n    name:'',\n    email:'',\n    phone:'',\n    address: '',\n    url: '',\n    image_id: '',\n    organisation:'',\n    message:''\n  };\n\n\n  $.datas.layers.base = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {\n    attribution: 'Tiles &copy; CartoDB'\n  });\n\n  $.datas.map = L.map('wo_map', {\n    layers: [$.datas.layers.base],\n    center: [48.209272, 16.372801],\n    zoom: 12,\n    zoomControl: false,\n    touchZoom: false\n  });\n\n  //Zoom Controls to right\n  new L.Control.Zoom({\n    position: 'topright'\n  }).addTo($.datas.map);\n\n  //fullscreen button\n  L.control.fullscreen({\n    position: 'topright',\n    title: {\n      'false': 'Vollbildanzeige',\n      'true': 'Vollbild verlassen'\n    }\n  }).addTo($.datas.map);\n\n\n  $.datas.layer = L.Util.ajax(\"/api/pois/all\").then(function(data) {\n    $.datas.layers.markers = L.geoJson.css(data);\n    $.datas.layers.markers.addTo($.datas.map);\n  });\n\n  //\n  $('.map_overlay').on('click', function(e) {\n    $(this).fadeOut(function() {\n      $(this).remove()\n    });\n  });\n\n\n  //FROM STUFF\n  //switch forms\n  $('#showEventsForm').on('click', function() {\n    if ($('#eventForm').hasClass('hidden')) {\n      $('#eventForm').animateCss('fadeInDown', '', '#eventForm');\n      $('#solidarischForm').animateCss('zoomOutLeft', 'hidden');\n    } else {\n      $('#solidarischForm').animateCss('fadeInDown', '', '#solidarischForm');\n      $('#eventForm').animateCss('zoomOutLeft', 'hidden');\n    }\n  });\n\n  //validate and submit solidarisch form\n  $('#solidarisch').validate({\n    errorElement: 'div',\n    errorPlacement: function(error, element) {\n      error.appendTo(element.parent(\".input-field\"));\n    },\n    submitHandler: function(form) {\n      newHuman.firstname = $('#firstname').val();\n      newHuman.lastname = $('#lastname').val();\n      newHuman.email = $('#email').val();\n      newHuman.newsletter = $('#newsletter').is(\":checked\");\n      newHuman.lat = $.datas.newPoint.address.geometry.coordinates[0];\n      newHuman.lng = $.datas.newPoint.address.geometry.coordinates[1];\n      $('#solidarisch .btn').attr('disabled', true);\n      $.post('/api/pois/humans', newHuman, function(response) {\n        swal({\n          title: \"Danke für dein WELCOMEoida!\",\n          text: \"Dein Pin wurde auf die Karte gesetzt!\",\n          type: \"success\",\n          confirmButtonText: \"Ok!\",\n          confirmButtonColor: \"#EB5B27\"\n        });\n        //resetMarker();\n        //source.setData(url);\n        drawMarker('human', [newHuman.lat, newHuman.lng]);\n\n        $('#solidarisch')[0].reset();\n        $('#solidarisch label').removeClass('active');\n        $('#solidarisch .btn').removeAttr('disabled');\n      }).error(function(response) {\n        swal({\n          title: \"Ouch!\",\n          text: \"Da ist etwas schiefgelaufen!\",\n          type: \"error\",\n          confirmButtonText: \"Ok!\",\n          confirmButtonColor: \"#EB5B27\"\n        });\n        $('#solidarisch .btn').removeAttr('disabled');\n      });\n    }\n  });\n\n  //validate and submit solidarisch form\n  $('#event').validate({\n    errorElement: 'div',\n    errorPlacement: function(error, element) {\n      error.appendTo(element.parent(\".input-field\"));\n    },\n    submitHandler: function(form) {\n\n      newEvent.title = $('#event_title').val();\n      newEvent.address = $.datas.newPoint.address;\n      newEvent.from_date = $('#event_from').val();\n      newEvent.to_date = $('#event_to').val();\n      newEvent.phone = $('#event_phone').val();\n      newEvent.url = $('#event_url').val();\n      newEvent.description = $('#event_description').val();\n      newEvent.lat = $.datas.newPoint.address.geometry.coordinates[0];\n      newEvent.lng = $.datas.newPoint.address.geometry.coordinates[1];\n      if ($.datas.newImage) {\n        newEvent.image_id = $.datas.newImage.id;\n      }\n\n      $('#event .btn').attr('disabled', true);\n      $.post('/api/pois/events', newEvent, function(response) {\n        swal({\n          title: \"Baam!\",\n          text: \"Deine Veranstaltung wurde erfolgreich gespeichert!\",\n          type: \"success\",\n          confirmButtonText: \"Ok!\",\n          confirmButtonColor: \"#EB5B27\"\n        });\n        drawMarker('event', [newEvent.lat, newEvent.lng]);\n        $('#event')[0].reset();\n        $('#event label').removeClass('active');\n        $('#event .btn').removeAttr('disabled');\n        //$(\"#image-upload\").removeAllFiles();\n      }).error(function(response) {\n        if (response.status == 401) {\n          swal({\n            title: \"Nicht erlaubt!\",\n            text: \"Bitte logge dich ein um ein Event zu erstellen!\",\n            type: \"error\",\n            confirmButtonText: \"Ok!\",\n            confirmButtonColor: \"#EB5B27\"\n          });\n        } else {\n          swal({\n            title: \"Ouch!\",\n            text: \"Da ist etwas schiefgelaufen!\",\n            type: \"error\",\n            confirmButtonText: \"Ok!\",\n            confirmButtonColor: \"#EB5B27\"\n          });\n        }\n\n        $('#event .btn').removeAttr('disabled');\n      });\n    }\n  });\n\n  //validate and submit solidarisch form\n  $('#partner').validate({\n    errorElement: 'div',\n    errorPlacement: function(error, element) {\n      error.appendTo(element.parent(\".input-field\"));\n    },\n    submitHandler: function(form) {\n\n      newPartner.name = $('#partner_name').val();\n      newPartner.email = $('#partner_email').val();\n      newPartner.address = $('#partner_location').val();\n      newPartner.phone = $('#partner_phone').val();\n      newPartner.url = $('#partner_url').val();\n      newPartner.organisation = $('#partner_organisation').val();\n      newPartner.message = $('#partner_message').val();\n      newPartner.image_id = 0;\n      if ($.datas.partnerImage) {\n        newPartner.image_id = $.datas.partnerImage.id;\n      }\n      else{\n        swal({\n          title: \"Kein Logo?\",\n          text: \"Wir benötigen dein Logo für unsere Website!\",\n          type: \"error\",\n          confirmButtonText: \"Ok!\",\n          confirmButtonColor: \"#EB5B27\"\n        });\n        return false;\n      }\n\n      $('#partner .btn').attr('disabled', true);\n      $.post('/api/partners', newPartner, function(response) {\n        $('#modalPartner').closeModal();\n        swal({\n          title: \"Baam!\",\n          text: \"Deine Partneranfrage wurde erfolgreich gesendet!\",\n          type: \"success\",\n          confirmButtonText: \"Ok!\",\n          confirmButtonColor: \"#EB5B27\"\n        });\n\n        $('#partner')[0].reset();\n        $('#partner label').removeClass('active');\n        $('#partner .btn').removeAttr('disabled');\n        $('#modalPartner').closeModal();\n        //$(\"#image-upload\").removeAllFiles();\n      }).error(function(response) {\n        if (response.status == 401) {\n          swal({\n            title: \"Nicht erlaubt!\",\n            text: \"Bitte logge dich ein um ein Event zu erstellen!\",\n            type: \"error\",\n            confirmButtonText: \"Ok!\",\n            confirmButtonColor: \"#EB5B27\"\n          });\n        } else {\n          swal({\n            title: \"Ouch!\",\n            text: \"Da ist etwas schiefgelaufen!\",\n            type: \"error\",\n            confirmButtonText: \"Ok!\",\n            confirmButtonColor: \"#EB5B27\"\n          });\n        }\n\n        $('#partner .btn').removeAttr('disabled');\n      });\n    }\n  });\n\n  //autocomplete address input with mapzen remote\n  $('.location').autocomplete({\n    serviceUrl: 'https://search.mapzen.com/v1/search',\n    dataType: 'json',\n    paramName: 'text',\n    params: {\n      \"api_key\": \"search-Jssufg0\"\n    },\n    minChars: 3,\n    transformResult: function(response) {\n      return {\n        suggestions: $.map(response.features, function(item) {\n          return {\n            value: item.properties.label,\n            data: item\n          }\n        })\n      }\n    },\n    onSelect: function(suggestion) {\n      $.datas.newPoint.address = suggestion.data;\n      var coordinates = suggestion.data.geometry.coordinates;\n      //TODO: When rest of form is valid\n      $('#solidarisch .btn').removeAttr('disabled');\n\n      drawMarker('base', coordinates);\n\n    }\n  });\n\n\n  //define image uploader\n  var uploader = $(\"#image-upload\").dropzone({\n    init: function() {\n      this.on(\"success\", function(file) {\n        $.datas.newImage = JSON.parse(file.xhr.response);\n      });\n    },\n    paramName: 'image',\n    maxFilesize: 4,\n    multiple: false,\n    maxFiles: 1,\n    addRemoveLinks: true,\n    acceptedFiles: 'image/*',\n    url: \"/api/images\",\n    thumbnailWidth: 336,\n    thumbnailHeight: 150,\n    dictRemoveFile: 'Bild löschen',\n    dictInvalidFileType: 'Bilddatei?',\n    dictFileTooBig: 'Die Datei ist zu groß!',\n\n  });\n  var uploader = $(\"#logo-uploader\").dropzone({\n    init: function() {\n      this.on(\"success\", function(file) {\n        $.datas.partnerImage = JSON.parse(file.xhr.response);\n      });\n    },\n    paramName: 'image',\n    maxFilesize: 4,\n    multiple: false,\n    maxFiles: 1,\n    addRemoveLinks: true,\n    acceptedFiles: 'image/*',\n    url: \"/api/images/public\",\n    thumbnailWidth: 336,\n    thumbnailHeight: 150,\n    dictRemoveFile: 'Bild löschen',\n    dictInvalidFileType: 'Bilddatei?',\n    dictFileTooBig: 'Die Datei ist zu groß!',\n\n  });\n\n  $('.timeinput').timepicker({\n    timeFormat: 'H:i'\n  });\n\n  var HeatSwitch = L.Control.extend({\n    options: {\n      position: 'topright'\n    },\n\n    onAdd: function(map) {\n      var container = L.DomUtil.create('div', 'layer-toogler leaflet-bar');\n      this._link = L.DomUtil.create('a', 'leaflet-bar-part', container);\n      this._link.href = '#';\n      this._link.title = \"Marker/Heatmap\";\n      this._icon = L.DomUtil.create('span', 'fa fa-bullseye', this._link);\n      L.DomEvent\n        .on(this._link, 'click', L.DomEvent.stopPropagation)\n        .on(this._link, 'click', L.DomEvent.preventDefault)\n        .on(this._link, 'click', function() {\n          if ($.datas.map.hasLayer($.datas.layers.heat)) {\n            L.DomUtil.removeClasses(this._icon, 'fa fa-circle');\n            L.DomUtil.addClasses(this._icon, 'fa fa-bullseye');\n            $.datas.map.removeLayer($.datas.layers.heat);\n            $.datas.map.addLayer($.datas.layers.markers);\n          } else {\n\n            L.DomUtil.removeClasses(this._icon, 'fa fa-bullseye');\n            L.DomUtil.addClasses(this._icon, 'fa fa-circle');\n            $.datas.map.removeLayer($.datas.layers.markers);\n            $.datas.map.addLayer($.datas.layers.heat);\n          }\n        }, this)\n        .on(this._link, 'dblclick', L.DomEvent.stopPropagation);\n\n      return container;\n    }\n  });\n\n  $.datas.map.addControl(new HeatSwitch());\n\n  $.get('/api/pois/raw/all', function(data) {\n    $.datas.layers.heat = L.heatLayer(data, {\n      radius: 15,\n      gradient: {\n        0.4: '#11A0D2',\n        0.5: '#B8DAB7',\n        1: '#EB5B27'\n      }\n    });\n  })\n\n  function drawMarker(type, coordinates) {\n    if ($.datas.newPoint.marker) {\n      $.datas.newPoint.marker.remove();\n    };\n    $.datas.newPoint.marker = L.marker([coordinates[1], coordinates[0]], {\n      icon: $.datas.icons[type],\n      draggable: true,\n      riseOnHover: true,\n    });\n    $.datas.newPoint.marker.addTo($.datas.map);\n    $.datas.newPoint.marker.on('dragend', function(e) {\n      $.datas.newPoint.address.geometry.coordinates[1] = e.target._latlng.lat;\n      $.datas.newPoint.address.geometry.coordinates[0] = e.target._latlng.lng;\n    });\n    $.datas.map.flyTo([coordinates[1], coordinates[0]], 13);\n  }\n\n});\n"],"sourceRoot":"/source/"}