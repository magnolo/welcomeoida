{"version":3,"sources":["map.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"map.js","sourcesContent":["$(function(){\n  //define variables\n\t$.datas = {\n\t\tmap : null,\n\t\tlayer: null,\n\t\ticons:{\n\t\t\tbase: L.divIcon({\n\t\t\t\tclassName: 'baseIcon'\n\t\t\t}),\n\t\t\tevent:L.icon({\n\t\t\t    iconUrl: '/images/markers/bubble.png',\n\t\t\t    iconSize: [40, 33],\n\t\t\t    iconAnchor: [20, 33],\n\t\t\t    popupAnchor: [0, -20],\n\t\t\t    //shadowUrl: '/images/markers/bubble_shadow.png',\n\t\t\t    //shadowRetinaUrl: 'my-icon-shadow@2x.png',\n\t\t\t    //shadowSize: [40, 33],\n\t\t\t  \t//shadowAnchor: [20, 33]\n\t\t\t}),\n\t\t\thuman:L.icon({\n\t\t\t    iconUrl: '/images/markers/ball.png',\n\t\t\t    iconSize: [12, 12],\n\t\t\t    iconAnchor: [6, 6],\n\t\t\t    //popupAnchor: [0, -20],\n\t\t\t    //shadowUrl: 'my-icon-shadow.png',\n\t\t\t    //shadowRetinaUrl: 'my-icon-shadow@2x.png',\n\t\t\t    //shadowSize: [68, 95],\n\t\t\t    //shadowAnchor: [22, 94]\n\t\t\t})\n\t\t},\n\t\tnewPoint : {\n\t\t\taddress: null,\n\t    marker: null\n\t\t},\n\t\tnewImage : null\n\t}\n\tvar newHuman = {\n\t\tname: '',\n\t\temail: '',\n\t\taddress: null\n\t};\n\tvar newEvent = {\n\t\tname: '',\n\t\temail: '',\n\t\taddress: null\n\t};\n\n\n  var baseLayer = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png',{attribution: 'Tiles &copy; CartoDB'});\n\n  $.datas.map = L.map('wo_map', {\n    layers:[baseLayer],\n    center: [ 48.209272, 16.372801],\n    zoom:12,\n    zoomControl: false,\n    touchZoom: false\n  });\n\n  //Zoom Controls to right\n  new L.Control.Zoom({ position: 'topright' }).addTo($.datas.map);\n\n    //fullscreen button\n  L.control.fullscreen({\n    position:'topright',\n    title:{\n      'false': 'Vollbildanzeige',\n      'true': 'Vollbild verlassen'\n    }\n  }).addTo($.datas.map);\n\n  // DRAW ICON BY DRAGGING ON MAP\n  // var drawnItems = new L.FeatureGroup();\n  // //$.datas.map.addLayer(drawnItems);\n  //\n  // // Initialise the draw control and pass it the FeatureGroup of editable layers\n  // var drawControl = new L.Control.Draw({\n  //     position:'topright',\n  //     edit: {\n  //         featureGroup: drawnItems,\n  //     },\n  //     draw:{\n  //       polyline:false,\n  //       polygon:false,\n  //       rectangle:false,\n  //       circle:false\n  //     }\n  // });\n  // drawControl.addTo($.datas.map);\n  // $.datas.map.on('draw:created', function (e) {\n  //   var type = e.layerType,\n  //       layer = e.layer;\n  //\n  //   if (type === 'marker') {\n  //       // Do marker specific actions\n  //       console.log('markt')\n  //   }\n  //\n  //   // Do whatever else you need to. (save to db, add to map etc)\n  //   $.datas.map.addLayer(layer);\n  // });\n\n\n  // LOCATE ME\n  L.control.locate({\n      position: 'topright',  // set the location of the control\n      layer: undefined,  // use your own layer for the location marker, creates a new layer by default\n      drawCircle: true,  // controls whether a circle is drawn that shows the uncertainty about the location\n      follow: true,  // follow the user's location\n      setView: true, // automatically sets the map view to the user's location, enabled if `follow` is true\n      keepCurrentZoomLevel: false, // keep the current map zoom level when displaying the user's location. (if `false`, use maxZoom)\n      stopFollowingOnDrag: false, // stop following when the map is dragged if `follow` is true (deprecated, see below)\n      remainActive: false, // if true locate control remains active on click even if the user's location is in view.\n      markerClass: L.circleMarker, // L.circleMarker or L.marker\n      circleStyle: {\n        color:'#EB5B27',\n        opacity:0.2,\n        fillColor:'#EB5B27'\n      },  // change the style of the circle around the user's location\n      markerStyle: {\n        color:'#EB5B27',\n        opacity:1,\n        fillColor:'#EB5B27'\n      },\n      followCircleStyle: {},  // set difference for the style of the circle around the user's location while following\n      followMarkerStyle: {},\n      icon: 'fa fa-map-marker',  // class for icon, fa-location-arrow or fa-map-marker\n      iconLoading: 'fa fa-spinner fa-spin',  // class for loading icon\n      iconElementTag: 'span',  // tag for the icon element, span or i\n      circlePadding: [0, 0], // padding around accuracy circle, value is passed to setBounds\n      metric: true,  // use metric or imperial units\n      onLocationError: function(err) {alert(err.message)},  // define an error callback function\n      onLocationOutsideMapBounds:  function(context) { // called when outside map boundaries\n              alert(context.options.strings.outsideMapBoundsMsg);\n      },\n      showPopup: true, // display a popup when the user click on the inner marker\n      strings: {\n          title: \"Zeige mir wo ich bin\",  // title of the locate control\n          metersUnit: \"metern\", // string for metric units\n          feetUnit: \"feet\", // string for imperial units\n          popup: \"Du befindest dich im Umkreis von {distance} {unit} zu diesem Punkt\",  // text to appear if user clicks on circle\n          outsideMapBoundsMsg: \"Du befindest dich außerhalb der Grenzen dieser Karte!?\" // default message for onLocationOutsideMapBounds\n      },\n      locateOptions: {}  // define location options e.g enableHighAccuracy: true or maxZoom: 10\n  }).addTo($.datas.map);\n\n  $.datas.layer = L.Util.ajax(\"/api/pois/all\").then(function(data){\n    L.geoJson.css(data).addTo($.datas.map);\n  });\n\n\n\n  //FROM STUFF\n  //switch forms\n\t$('#showEventsForm').on('click', function(){\n\t\tif( $('#eventForm').hasClass('hidden')){\n\t\t\t$('#eventForm').animateCss('fadeInDown','', '#event');\n\t\t\t$('#solidarischForm').animateCss('zoomOutLeft', 'hidden');\n\t\t}\n\t\telse{\n\t\t\t$('#solidarischForm').animateCss('fadeInDown');\n\t\t\t\t$('#eventForm').animateCss('zoomOutLeft', 'hidden');\n\t\t\t}\n\t});\n\n\t//validate and submit solidarisch form\n\t$('#solidarisch').validate({\n\t\terrorElement:'div',\n\t\terrorPlacement: function(error, element) {\n\t\t error.appendTo( element.parent(\".input-field\"));\n\t },\n\t\tsubmitHandler: function (form) {\n\t\t\tnewHuman.firstname = $('#firstname').val();\n\t\t\tnewHuman.lastname = $('#lastname').val();\n\t\t\tnewHuman.email = $('#email').val();\n\t\t\tnewHuman.lat = $.datas.newPoint.address.geometry.coordinates[0];\n\t\t\tnewHuman.lng = $.datas.newPoint.address.geometry.coordinates[1];\n\t\t\t$('#solidarisch .btn').attr('disabled', true);\n\t\t\t$.post('/api/pois/humans', newHuman, function (response) {\n\t\t\t\tswal({\n\t\t\t\t\ttitle: \"Baam!\",\n\t\t\t\t\ttext: \"Dein Pin wurde auf die Karte gesetzt!\",\n\t\t\t\t\ttype: \"success\",\n\t\t\t\t\tconfirmButtonText: \"Ok!\",\n\t\t\t\t\tconfirmButtonColor: \"#EB5B27\"\n\t\t\t\t});\n\t\t\t\t//resetMarker();\n\t\t\t\t//source.setData(url);\n\t\t\t\tdrawMarker('human', [newHuman.lat, newHuman.lng]);\n\n\t\t\t\t$('#solidarisch')[0].reset();\n\t\t\t\t$('#solidarisch label').removeClass('active');\n\t\t\t\t$('#solidarisch .btn').removeAttr('disabled');\n\t\t\t}).error(function(response){\n\t\t\t\tswal({\n\t\t\t\t\ttitle: \"Ouch!\",\n\t\t\t\t\ttext: \"Da ist etwas schiefgelaufen!\",\n\t\t\t\t\ttype: \"error\",\n\t\t\t\t\tconfirmButtonText: \"Ok!\",\n\t\t\t\t\tconfirmButtonColor: \"#EB5B27\"\n\t\t\t\t});\n\t\t\t\t$('#solidarisch .btn').removeAttr('disabled');\n\t\t\t});\n\t\t}\n\t});\n\n\t//validate and submit solidarisch form\n\t$('#event').validate({\n\t\terrorElement:'div',\n\t\terrorPlacement: function(error, element) {\n\t\t error.appendTo( element.parent(\".input-field\"));\n\t },\n\t\tsubmitHandler: function (form) {\n\n\t\t\tnewEvent.title = $('#event_title').val();\n\t\t\tnewEvent.address = $.datas.newPoint.address;\n\t\t\tnewEvent.from_date = $('#event_from').val();\n\t\t\tnewEvent.to_date = $('#event_to').val();\n\t\t\tnewEvent.phone = $('#event_phone').val();\n\t\t\tnewEvent.url = $('#event_url').val();\n\t\t\tnewEvent.description = $('#event_description').val();\n\t\t\tnewEvent.lat = $.datas.newPoint.address.geometry.coordinates[0];\n\t\t\tnewEvent.lng = $.datas.newPoint.address.geometry.coordinates[1];\n      if($.datas.newImage.id){\n        newEvent.image_id = $.datas.newImage.id;\n      }\n\n\t\t\t$('#event .btn').attr('disabled', true);\n\t\t\t$.post('/api/pois/events', newEvent, function (response) {\n\t\t\t\tswal({\n\t\t\t\t\ttitle: \"Baam!\",\n\t\t\t\t\ttext: \"Deine Veranstaltung wurde erfolgreich gespeichert!\",\n\t\t\t\t\ttype: \"success\",\n\t\t\t\t\tconfirmButtonText: \"Ok!\",\n\t\t\t\t\tconfirmButtonColor: \"#EB5B27\"\n\t\t\t\t});\n        drawMarker('event', [newEvent.lat, newEvent.lng]);\n\t\t\t\t$('#event')[0].reset();\n\t\t\t\t$('#event label').removeClass('active');\n        $('#event .btn').removeAttr('disabled');\n\t\t\t}).error(function(response){\n\t\t\t\tswal({\n\t\t\t\t\ttitle: \"Ouch!\",\n\t\t\t\t\ttext: \"Da ist etwas schiefgelaufen!\",\n\t\t\t\t\ttype: \"error\",\n\t\t\t\t\tconfirmButtonText: \"Ok!\",\n\t\t\t\t\tconfirmButtonColor: \"#EB5B27\"\n\t\t\t\t});\n\t\t\t\t$('#event .btn').removeAttr('disabled');\n\t\t\t});\n\t\t}\n\t});\n\n\n\t//autocomplete address input with mapzen remote\n\t$('.location').autocomplete({\n\t\tserviceUrl: 'https://search.mapzen.com/v1/search',\n\t\tdataType: 'json',\n\t\tparamName: 'text',\n\t\tparams: {\n\t\t\t\"api_key\": \"search-Jssufg0\"\n\t\t},\n\t\tminChars: 3,\n\t\ttransformResult: function (response) {\n\t\t\treturn {\n\t\t\t\tsuggestions: $.map(response.features, function (item) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tvalue: item.properties.label,\n\t\t\t\t\t\tdata: item\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\tonSelect: function (suggestion) {\n    \t$.datas.newPoint.address = suggestion.data;\n\t\t\tvar coordinates = suggestion.data.geometry.coordinates;\n\t\t\t//TODO: When rest of form is valid\n\t\t\t$('#solidarisch .btn').removeAttr('disabled');\n\n\t\t\tdrawMarker('base', coordinates);\n\n\t\t}\n\t});\n\n\n\t//define image uploader\n\t$(\"#image-upload\").dropzone({\n\t\tinit:function(){\n\t\t\t this.on(\"success\", function(file) {\n\t\t\t\t\t$.datas.newImage = JSON.parse(file.xhr.response);\n\t\t\t });\n\t\t},\n\t\tparamName:'image',\n\t\tmaxFilesize: 4,\n\t\tmultiple:false,\n\t\tmaxFiles:1,\n\t\taddRemoveLinks:true,\n\t\tacceptedFiles:'image/*',\n\t\turl: \"/api/images\",\n\t\tthumbnailWidth:336,\n\t\tthumbnailHeight:150,\n\t\tdictRemoveFile:'Bild löschen',\n\t\tdictInvalidFileType:'Bilddatei?',\n\t\tdictFileTooBig:'Die Datei ist zu groß!',\n\n\t});\n\n  $('.timeinput').timepicker({\n    timeFormat: 'H:i'\n  });\n\n\tfunction drawMarker(type, coordinates){\n\t\tif($.datas.newPoint.marker){\n\t\t\t$.datas.newPoint.marker.remove();\n\t\t};\n\t\t$.datas.newPoint.marker = L.marker([coordinates[1], coordinates[0]],{\n\t\t\ticon: $.datas.icons[type],\n\t\t\tdraggable:true,\n\t\t\triseOnHover:true,\n\t\t});\n\t\t$.datas.newPoint.marker.addTo($.datas.map);\n\t\t$.datas.newPoint.marker.on('dragend', function(e){\n\t\t\t$.datas.newPoint.address.geometry.coordinates[1] = e.target._latlng.lat;\n\t\t\t$.datas.newPoint.address.geometry.coordinates[0] = e.target._latlng.lng;\n\t\t});\n\t\t$.datas.map.flyTo([coordinates[1], coordinates[0]], 13);\n\t}\n\n});\n"],"sourceRoot":"/source/"}