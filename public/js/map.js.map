{"version":3,"sources":["map.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"map.js","sourcesContent":["$(function() {\n  //define variables\n  $.datas = {\n    map: null,\n    layer: null,\n    layers: {\n      heat: null,\n      base: null,\n      markers: null\n    },\n    icons: {\n      base: L.divIcon({\n        className: 'baseIcon'\n      }),\n      event: L.icon({\n        iconUrl: '/images/markers/bubble.png',\n        iconSize: [40, 33],\n        iconAnchor: [20, 33],\n        popupAnchor: [0, -20],\n        //shadowUrl: '/images/markers/bubble_shadow.png',\n        //shadowRetinaUrl: 'my-icon-shadow@2x.png',\n        //shadowSize: [40, 33],\n        //shadowAnchor: [20, 33]\n      }),\n      human: L.icon({\n        iconUrl: '/images/markers/ball.png',\n        iconSize: [12, 12],\n        iconAnchor: [6, 6],\n        //popupAnchor: [0, -20],\n        //shadowUrl: 'my-icon-shadow.png',\n        //shadowRetinaUrl: 'my-icon-shadow@2x.png',\n        //shadowSize: [68, 95],\n        //shadowAnchor: [22, 94]\n      })\n    },\n    newPoint: {\n      address: null,\n      marker: null\n    },\n    newImage: null\n  }\n  var newHuman = {\n    name: '',\n    email: '',\n    address: null\n  };\n  var newEvent = {\n    name: '',\n    email: '',\n    address: null\n  };\n\n\n  $.datas.layers.base = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {\n    attribution: 'Tiles &copy; CartoDB'\n  });\n\n  $.datas.map = L.map('wo_map', {\n    layers: [$.datas.layers.base],\n    center: [48.209272, 16.372801],\n    zoom: 12,\n    zoomControl: false,\n    touchZoom: false\n  });\n\n  //Zoom Controls to right\n  new L.Control.Zoom({\n    position: 'topright'\n  }).addTo($.datas.map);\n\n  //fullscreen button\n  L.control.fullscreen({\n    position: 'topright',\n    title: {\n      'false': 'Vollbildanzeige',\n      'true': 'Vollbild verlassen'\n    }\n  }).addTo($.datas.map);\n\n  // DRAW ICON BY DRAGGING ON MAP\n  // var drawnItems = new L.FeatureGroup();\n  // //$.datas.map.addLayer(drawnItems);\n  //\n  // // Initialise the draw control and pass it the FeatureGroup of editable layers\n  // var drawControl = new L.Control.Draw({\n  //     position:'topright',\n  //     edit: {\n  //         featureGroup: drawnItems,\n  //     },\n  //     draw:{\n  //       polyline:false,\n  //       polygon:false,\n  //       rectangle:false,\n  //       circle:false\n  //     }\n  // });\n  // drawControl.addTo($.datas.map);\n  // $.datas.map.on('draw:created', function (e) {\n  //   var type = e.layerType,\n  //       layer = e.layer;\n  //\n  //   if (type === 'marker') {\n  //       // Do marker specific actions\n  //       console.log('markt')\n  //   }\n  //\n  //   // Do whatever else you need to. (save to db, add to map etc)\n  //   $.datas.map.addLayer(layer);\n  // });\n\n\n  // LOCATE ME\n  L.control.locate({\n    position: 'topright', // set the location of the control\n    layer: undefined, // use your own layer for the location marker, creates a new layer by default\n    drawCircle: true, // controls whether a circle is drawn that shows the uncertainty about the location\n    follow: true, // follow the user's location\n    setView: true, // automatically sets the map view to the user's location, enabled if `follow` is true\n    keepCurrentZoomLevel: false, // keep the current map zoom level when displaying the user's location. (if `false`, use maxZoom)\n    stopFollowingOnDrag: false, // stop following when the map is dragged if `follow` is true (deprecated, see below)\n    remainActive: false, // if true locate control remains active on click even if the user's location is in view.\n    markerClass: L.circleMarker, // L.circleMarker or L.marker\n    circleStyle: {\n      color: '#EB5B27',\n      opacity: 0.2,\n      fillColor: '#EB5B27'\n    }, // change the style of the circle around the user's location\n    markerStyle: {\n      color: '#EB5B27',\n      opacity: 1,\n      fillColor: '#EB5B27'\n    },\n    followCircleStyle: {}, // set difference for the style of the circle around the user's location while following\n    followMarkerStyle: {},\n    icon: 'fa fa-map-marker', // class for icon, fa-location-arrow or fa-map-marker\n    iconLoading: 'fa fa-spinner fa-spin', // class for loading icon\n    iconElementTag: 'span', // tag for the icon element, span or i\n    circlePadding: [0, 0], // padding around accuracy circle, value is passed to setBounds\n    metric: true, // use metric or imperial units\n    onLocationError: function(err) {\n      alert(err.message)\n    }, // define an error callback function\n    onLocationOutsideMapBounds: function(context) { // called when outside map boundaries\n      alert(context.options.strings.outsideMapBoundsMsg);\n    },\n    showPopup: true, // display a popup when the user click on the inner marker\n    strings: {\n      title: \"Zeige mir wo ich bin\", // title of the locate control\n      metersUnit: \"metern\", // string for metric units\n      feetUnit: \"feet\", // string for imperial units\n      popup: \"Du befindest dich im Umkreis von {distance} {unit} zu diesem Punkt\", // text to appear if user clicks on circle\n      outsideMapBoundsMsg: \"Du befindest dich außerhalb der Grenzen dieser Karte!?\" // default message for onLocationOutsideMapBounds\n    },\n    locateOptions: {} // define location options e.g enableHighAccuracy: true or maxZoom: 10\n  }).addTo($.datas.map);\n\n  $.datas.layer = L.Util.ajax(\"/api/pois/all\").then(function(data) {\n    $.datas.layers.markers = L.geoJson.css(data);\n    $.datas.layers.markers.addTo($.datas.map);\n  });\n\n  //\n  $('.map_overlay').on('click', function(e) {\n    $(this).fadeOut(function() {\n      $(this).remove()\n    });\n  });\n\n\n  //FROM STUFF\n  //switch forms\n  $('#showEventsForm').on('click', function() {\n    if ($('#eventForm').hasClass('hidden')) {\n      $('#eventForm').animateCss('fadeInDown', '', '#eventForm');\n      $('#solidarischForm').animateCss('zoomOutLeft', 'hidden');\n    } else {\n      $('#solidarischForm').animateCss('fadeInDown', '', '#solidarischForm');\n      $('#eventForm').animateCss('zoomOutLeft', 'hidden');\n    }\n  });\n\n  //validate and submit solidarisch form\n  $('#solidarisch').validate({\n    errorElement: 'div',\n    errorPlacement: function(error, element) {\n      error.appendTo(element.parent(\".input-field\"));\n    },\n    submitHandler: function(form) {\n      newHuman.firstname = $('#firstname').val();\n      newHuman.lastname = $('#lastname').val();\n      newHuman.email = $('#email').val();\n      newHuman.lat = $.datas.newPoint.address.geometry.coordinates[0];\n      newHuman.lng = $.datas.newPoint.address.geometry.coordinates[1];\n      $('#solidarisch .btn').attr('disabled', true);\n      $.post('/api/pois/humans', newHuman, function(response) {\n        swal({\n          title: \"Baam!\",\n          text: \"Dein Pin wurde auf die Karte gesetzt!\",\n          type: \"success\",\n          confirmButtonText: \"Ok!\",\n          confirmButtonColor: \"#EB5B27\"\n        });\n        //resetMarker();\n        //source.setData(url);\n        drawMarker('human', [newHuman.lat, newHuman.lng]);\n\n        $('#solidarisch')[0].reset();\n        $('#solidarisch label').removeClass('active');\n        $('#solidarisch .btn').removeAttr('disabled');\n      }).error(function(response) {\n        swal({\n          title: \"Ouch!\",\n          text: \"Da ist etwas schiefgelaufen!\",\n          type: \"error\",\n          confirmButtonText: \"Ok!\",\n          confirmButtonColor: \"#EB5B27\"\n        });\n        $('#solidarisch .btn').removeAttr('disabled');\n      });\n    }\n  });\n\n  //validate and submit solidarisch form\n  $('#event').validate({\n    errorElement: 'div',\n    errorPlacement: function(error, element) {\n      error.appendTo(element.parent(\".input-field\"));\n    },\n    submitHandler: function(form) {\n\n      newEvent.title = $('#event_title').val();\n      newEvent.address = $.datas.newPoint.address;\n      newEvent.from_date = $('#event_from').val();\n      newEvent.to_date = $('#event_to').val();\n      newEvent.phone = $('#event_phone').val();\n      newEvent.url = $('#event_url').val();\n      newEvent.description = $('#event_description').val();\n      newEvent.lat = $.datas.newPoint.address.geometry.coordinates[0];\n      newEvent.lng = $.datas.newPoint.address.geometry.coordinates[1];\n      if ($.datas.newImage) {\n        newEvent.image_id = $.datas.newImage.id;\n      }\n\n      $('#event .btn').attr('disabled', true);\n      $.post('/api/pois/events', newEvent, function(response) {\n        swal({\n          title: \"Baam!\",\n          text: \"Deine Veranstaltung wurde erfolgreich gespeichert!\",\n          type: \"success\",\n          confirmButtonText: \"Ok!\",\n          confirmButtonColor: \"#EB5B27\"\n        });\n        drawMarker('event', [newEvent.lat, newEvent.lng]);\n        $('#event')[0].reset();\n        $('#event label').removeClass('active');\n        $('#event .btn').removeAttr('disabled');\n        //$(\"#image-upload\").removeAllFiles();\n      }).error(function(response) {\n        if (response.status == 401) {\n          swal({\n            title: \"Nicht erlaubt!\",\n            text: \"Bitte logge dich ein um ein Event zu erstellen!\",\n            type: \"error\",\n            confirmButtonText: \"Ok!\",\n            confirmButtonColor: \"#EB5B27\"\n          });\n        } else {\n          swal({\n            title: \"Ouch!\",\n            text: \"Da ist etwas schiefgelaufen!\",\n            type: \"error\",\n            confirmButtonText: \"Ok!\",\n            confirmButtonColor: \"#EB5B27\"\n          });\n        }\n\n        $('#event .btn').removeAttr('disabled');\n      });\n    }\n  });\n\n\n  //autocomplete address input with mapzen remote\n  $('.location').autocomplete({\n    serviceUrl: 'https://search.mapzen.com/v1/search',\n    dataType: 'json',\n    paramName: 'text',\n    params: {\n      \"api_key\": \"search-Jssufg0\"\n    },\n    minChars: 3,\n    transformResult: function(response) {\n      return {\n        suggestions: $.map(response.features, function(item) {\n          return {\n            value: item.properties.label,\n            data: item\n          }\n        })\n      }\n    },\n    onSelect: function(suggestion) {\n      $.datas.newPoint.address = suggestion.data;\n      var coordinates = suggestion.data.geometry.coordinates;\n      //TODO: When rest of form is valid\n      $('#solidarisch .btn').removeAttr('disabled');\n\n      drawMarker('base', coordinates);\n\n    }\n  });\n\n\n  //define image uploader\n  var uploader = $(\"#image-upload\").dropzone({\n    init: function() {\n      this.on(\"success\", function(file) {\n        $.datas.newImage = JSON.parse(file.xhr.response);\n      });\n    },\n    paramName: 'image',\n    maxFilesize: 4,\n    multiple: false,\n    maxFiles: 1,\n    addRemoveLinks: true,\n    acceptedFiles: 'image/*',\n    url: \"/api/images\",\n    thumbnailWidth: 336,\n    thumbnailHeight: 150,\n    dictRemoveFile: 'Bild löschen',\n    dictInvalidFileType: 'Bilddatei?',\n    dictFileTooBig: 'Die Datei ist zu groß!',\n\n  });\n\n  $('.timeinput').timepicker({\n    timeFormat: 'H:i'\n  });\n\n  var HeatSwitch = L.Control.extend({\n    options: {\n      position: 'topright'\n    },\n\n    onAdd: function(map) {\n      var container = L.DomUtil.create('div', 'layer-toogler leaflet-bar');\n      this._link = L.DomUtil.create('a', 'leaflet-bar-part', container);\n      this._link.href = '#';\n      this._link.title = \"Marker/Heatmap\";\n      this._icon = L.DomUtil.create('span', 'fa fa-bullseye', this._link);\n      L.DomEvent\n        .on(this._link, 'click', L.DomEvent.stopPropagation)\n        .on(this._link, 'click', L.DomEvent.preventDefault)\n        .on(this._link, 'click', function() {\n          if ($.datas.map.hasLayer($.datas.layers.heat)) {\n            L.DomUtil.removeClasses(this._icon, 'fa fa-circle');\n            L.DomUtil.addClasses(this._icon, 'fa fa-bullseye');\n            $.datas.map.removeLayer($.datas.layers.heat);\n            $.datas.map.addLayer($.datas.layers.markers);\n          } else {\n\n            L.DomUtil.removeClasses(this._icon, 'fa fa-bullseye');\n            L.DomUtil.addClasses(this._icon, 'fa fa-circle');\n            $.datas.map.removeLayer($.datas.layers.markers);\n            $.datas.map.addLayer($.datas.layers.heat);\n          }\n        }, this)\n        .on(this._link, 'dblclick', L.DomEvent.stopPropagation);\n\n      return container;\n    }\n  });\n\n  $.datas.map.addControl(new HeatSwitch());\n\n  $.get('/api/pois/raw/all', function(data) {\n    $.datas.layers.heat = L.heatLayer(data, {\n      radius: 15,\n      gradient: {\n        0.4: '#11A0D2',\n        0.5: '#B8DAB7',\n        1: '#EB5B27'\n      }\n    });\n  })\n\n  function drawMarker(type, coordinates) {\n    if ($.datas.newPoint.marker) {\n      $.datas.newPoint.marker.remove();\n    };\n    $.datas.newPoint.marker = L.marker([coordinates[1], coordinates[0]], {\n      icon: $.datas.icons[type],\n      draggable: true,\n      riseOnHover: true,\n    });\n    $.datas.newPoint.marker.addTo($.datas.map);\n    $.datas.newPoint.marker.on('dragend', function(e) {\n      $.datas.newPoint.address.geometry.coordinates[1] = e.target._latlng.lat;\n      $.datas.newPoint.address.geometry.coordinates[0] = e.target._latlng.lng;\n    });\n    $.datas.map.flyTo([coordinates[1], coordinates[0]], 13);\n  }\n\n});"],"sourceRoot":"/source/"}