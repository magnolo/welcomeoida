{"version":3,"sources":["map.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"map.js","sourcesContent":["$(function(){\n  //define mapbox api\n\tmapboxgl.accessToken = 'pk.eyJ1IjoibWFnbm9sbyIsImEiOiJuSFdUYkg4In0.5HOykKk0pNP1N3isfPQGTQ';\n\n\t//bin solidarisch form/submit oject\n\tvar newHuman = {\n\t\tname: '',\n\t\temail: '',\n\t\taddress: null\n\t};\n\tvar newEvent = {\n\t\tname: '',\n\t\temail: '',\n\t\taddress: null\n\t};\n\n\n\t//setup popup\n\tvar popup = new mapboxgl.Popup({\n\t\tcloseButton: false\n\t});\n\n\t//setup mapbox gl map\n\tvar map = new mapboxgl.Map({\n\t\tcontainer: 'wo_map',\n\t\tstyle: 'mapbox://styles/mapbox/light-v8',\n\t\tcenter: [16.372801, 48.209272],\n\t\tzoom: 10,\n\t});\n\n\t//Add zoom and rotation controls to the map.\n\tmap.addControl(new mapboxgl.Navigation());\n\n\t//setup GeoJSONSource from local API\n\tvar url = '/api/pois/all';\n\tvar source = new mapboxgl.GeoJSONSource({\n\t\tdata: url\n\t});\n\n\n\t//setup marker data for humans from lokal api\n\tmap.on('style.load', function () {\n\t\tmap.addSource('pois', source);\n\t\tmap.addLayer({\n\t\t\t\"id\": \"humans\",\n\t\t\t\"interactive\": true,\n\t\t\t\"type\": \"circle\",\n\t\t\t\"paint\": {\n\t\t\t\t\"circle-color\": '#EB5B27',\n\t\t\t\t\"circle-radius\": 5,\n        \"circle-radius-transition\": {\n\t\t\t\t\tduration: 250,\n          delay:0\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"source\": \"pois\",\n\t\t\t\"filter\": [\"==\", \"type_id\",1]\n\t\t\t// \"layout\": {\n\t\t\t// \t\t \"icon-image\": \"{marker-symbol}-15\",\n\t\t\t// \t\t \"text-offset\": [0, 0.6],\n\t\t\t// \t\t \"text-anchor\": \"top\"\n\t\t\t//  }\n\t\t});\n\t\tmap.addLayer({\n\t\t\t\"id\": \"events\",\n\t\t\t\"interactive\": true,\n\t\t\t\"type\": \"symbol\",\n\t\t\t// \"paint\": {\n\t\t\t// \t\"circle-color\": '#00ff00',\n\t\t\t// \t\"circle-radius\": 5,\n      //   \"circle-radius-transition\": {\n\t\t\t// \t\tduration: 250,\n      //     delay:0\n\t\t\t// \t},\n\t\t\t// },\n\t\t\t\"source\": \"pois\",\n\t\t\t\"filter\": [\"==\", \"type_id\",2],\n\t\t \"layout\": {\n\t\t \t\t \"icon-image\": \"marker-15\",\n\t\t \t\t \"text-offset\": [0, 0.6],\n\t\t \t\t \"text-anchor\": \"top\"\n\t\t  }\n\t\t});\n\n\t});\n\n\t//open popup for click on human marker\n\tmap.on('click', function (e) {\n\t\tmap.featuresAt(e.point, {\n\t\t\tradius: 15,\n\t\t\tincludeGeometry: true,\n\t\t\tlayer: ['humans','events'],\n\t\t}, function (err, features) {\n\t\t\tif (err || !features.length) {\n\t\t\t\tpopup.remove();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar feature = features[0];\n\t\t\tvar data = feature.properties;\n\t\t\tvar html = '';\n\t\t\tif(data.type_id == 1){\n\t\t\t\thtml = data.title;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif(data.image.id){\n\t\t\t\t\thtml += \"<img class='title-image' src='\"+data.image.path+\"' />\";\n\t\t\t\t}\n\t\t\t\thtml += \"<h5>\"+data.title+\"</h5>\";\n\t\t\t}\n\t\t\tpopup.setLngLat(feature.geometry.coordinates)\n\t\t\t\t.setHTML(html)\n\t\t\t\t.addTo(map);\n\t\t})\n\t});\n\n\t// Use the same approach as above to indicate that the symbols are clickable\n\t// by changing the cursor style to 'pointer'.\n\tmap.on('mousemove', function (e) {\n\t    map.featuresAt(e.point, {\n\t        radius:15, // Half the marker size (15px).\n\t        layer: 'humans'\n\t    }, function (err, features) {\n\t        map.getCanvas().style.cursor = (!err && features.length) ? 'pointer' : '';\n\t    });\n\t});\n\n  \t//validate and submit solidarisch form\n  \t$('#solidarisch').validate({\n      errorElement:'div',\n      errorPlacement: function(error, element) {\n       error.appendTo( element.parent(\".input-field\"));\n     },\n  \t\tsubmitHandler: function (form) {\n  \t\t\tnewHuman.firstname = $('#firstname').val();\n  \t\t\tnewHuman.lastname = $('#lastname').val();\n  \t\t\tnewHuman.email = $('#email').val();\n  \t\t\tnewHuman.lat = newHuman.address.geometry.coordinates[0];\n  \t\t\tnewHuman.lng = newHuman.address.geometry.coordinates[1];\n  \t\t\t$('#solidarisch .btn').attr('disabled', true);\n  \t\t\t$.post('/api/pois/humans', newHuman, function (response) {\n  \t\t\t\tswal({\n  \t\t\t\t\ttitle: \"Baam!\",\n  \t\t\t\t\ttext: \"Dein Pin wurde auf die Karte gesetzt!\",\n  \t\t\t\t\ttype: \"success\",\n  \t\t\t\t\tconfirmButtonText: \"Ok!\",\n  \t\t\t\t\tconfirmButtonColor: \"#EB5B27\"\n  \t\t\t\t});\n  \t\t\t\tresetMarker();\n  \t\t\t\tsource.setData(url);\n  \t\t\t\t$('#solidarisch')[0].reset();\n          $('#solidarisch label').removeClass('active');\n  \t\t\t}).error(function(response){\n\t\t\t\t\tswal({\n\t\t\t\t\t\ttitle: \"Ouch!\",\n\t\t\t\t\t\ttext: \"Da ist etwas schiefgelaufen!\",\n\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\tconfirmButtonText: \"Ok!\",\n\t\t\t\t\t\tconfirmButtonColor: \"#EB5B27\"\n\t\t\t\t\t});\n\t\t\t\t\t$('#solidarisch .btn').removeAttr('disabled');\n\t\t\t\t});\n  \t\t}\n  \t});\n\n\t\t//validate and submit solidarisch form\n  \t$('#event').validate({\n      errorElement:'div',\n      errorPlacement: function(error, element) {\n       error.appendTo( element.parent(\".input-field\"));\n     },\n  \t\tsubmitHandler: function (form) {\n\n\t\t\t\tnewEvent.title =$('#event_title').val();\n\t\t\t\tnewEvent.address = newHuman.address;\n  \t\t\tnewEvent.from_date = $('#event_from').val();\n  \t\t\tnewEvent.phone = $('#event_phone').val();\n  \t\t\tnewEvent.url = $('#event_url').val();\n\t\t\t\tnewEvent.description = $('#event_description').val();\n  \t\t\tnewEvent.lat = newHuman.address.geometry.coordinates[0];\n  \t\t\tnewEvent.lng = newHuman.address.geometry.coordinates[1];\n\t\t\t\tnewEvent.image_id = newImage.id;\n  \t\t\t$('#event .btn').attr('disabled', true);\n  \t\t\t$.post('/api/pois/events', newEvent, function (response) {\n  \t\t\t\tswal({\n  \t\t\t\t\ttitle: \"Baam!\",\n  \t\t\t\t\ttext: \"Deine Veranstaltung wurde erfolgreich gespeichert!\",\n  \t\t\t\t\ttype: \"success\",\n  \t\t\t\t\tconfirmButtonText: \"Ok!\",\n  \t\t\t\t\tconfirmButtonColor: \"#EB5B27\"\n  \t\t\t\t});\n  \t\t\t\tresetMarker();\n  \t\t\t\tsource.setData(url);\n  \t\t\t\t$('#event')[0].reset();\n          $('#event label').removeClass('active');\n  \t\t\t}).error(function(response){\n\t\t\t\t\tswal({\n\t\t\t\t\t\ttitle: \"Ouch!\",\n\t\t\t\t\t\ttext: \"Da ist etwas schiefgelaufen!\",\n\t\t\t\t\t\ttype: \"error\",\n\t\t\t\t\t\tconfirmButtonText: \"Ok!\",\n\t\t\t\t\t\tconfirmButtonColor: \"#EB5B27\"\n\t\t\t\t\t});\n\t\t\t\t\t$('#event .btn').removeAttr('disabled');\n\t\t\t\t});\n  \t\t}\n  \t});\n\n  \t//autocomplete address input with mapzen remote\n  \t$('.location').autocomplete({\n  \t\tserviceUrl: 'https://search.mapzen.com/v1/search',\n  \t\tdataType: 'json',\n  \t\tparamName: 'text',\n  \t\tparams: {\n  \t\t\t\"api_key\": \"search-Jssufg0\"\n  \t\t},\n  \t\tminChars: 3,\n  \t\ttransformResult: function (response) {\n  \t\t\treturn {\n  \t\t\t\tsuggestions: $.map(response.features, function (item) {\n  \t\t\t\t\treturn {\n  \t\t\t\t\t\tvalue: item.properties.label,\n  \t\t\t\t\t\tdata: item\n  \t\t\t\t\t}\n  \t\t\t\t})\n  \t\t\t}\n  \t\t},\n  \t\tonSelect: function (suggestion) {\n  \t\t\tnewHuman.address = suggestion.data;\n\n  \t\t\t//TODO: When rest of form is valid\n  \t\t\t$('#solidarisch .btn').removeAttr('disabled');\n\n  \t\t\taddMarker(suggestion.data);\n  \t\t\tfly(suggestion.data.geometry.coordinates)\n  \t\t}\n  \t});\n\n    var anim = null;\n  \t//remove the user marker if present\n  \tfunction resetMarker() {\n  \t\tvar lSource = map.getSource('newMarker');\n  \t\tif (typeof lSource != \"undefined\") {\n        if(anim){\n          window.cancelAnimationFrame(anim);\n        }\n  \t\t\tmap.removeLayer('newEntry');\n  \t\t\tmap.removeLayer('newEntry1');\n  \t\t\tmap.removeSource('newMarker');\n  \t\t}\n  \t}\n\n  \t//add a marker from geo feature\n  \tfunction addMarker(data) {\n  \t\tresetMarker();\n    \tvar framesPerSecond = 15;\n    \tvar initialOpacity = 1;\n    \tvar opacity = initialOpacity;\n    \tvar initialRadius = 5;\n    \tvar radius = initialRadius;\n    \tvar maxRadius = 12;\n\n\n  \t\tmap.addSource('newMarker', {\n  \t\t\ttype: 'geojson',\n  \t\t\tdata: data\n  \t\t});\n  \t\tmap.addLayer({\n  \t\t\t\"id\": \"newEntry\",\n  \t\t\t\"interactive\": true,\n  \t\t\t\"type\": \"circle\",\n  \t\t\t\"paint\": {\n  \t\t\t\t\"circle-radius\": 10,\n  \t\t\t\t\"circle-color\": \"#EB5B27\",\n          \"circle-opacity\": 0.5\n  \t\t\t},\n  \t\t\t\"source\": \"newMarker\",\n  \t\t});\n\n  \t\tmap.addLayer({\n  \t\t\t\"id\": \"newEntry1\",\n  \t\t\t\"source\": \"newMarker\",\n  \t\t\t\"type\": \"circle\",\n  \t\t\t\"paint\": {\n  \t\t\t\t\"circle-radius\": 5,\n  \t\t\t\t\"circle-color\": \"#EB5B27\"\n  \t\t\t}\n  \t\t});\n\n  \t\t// function animateMarker(timestamp) {\n  \t\t// \tsetTimeout(function () {\n      //\n    \t// \t\t\tanim = window.requestAnimationFrame(animateMarker);\n    \t// \t\t\tradius += (maxRadius - radius) / framesPerSecond;\n    \t// \t\t\topacity -= (.9 / framesPerSecond);\n      //\n    \t// \t\t\tif (opacity > 0) {\n      //\n    \t// \t\t\t\tmap.setPaintProperty('newEntry', 'circle-radius', radius);\n    \t// \t\t\t\tmap.setPaintProperty('newEntry', 'circle-opacity', opacity);\n    \t// \t\t\t} else {\n      //\n    \t// \t\t\t\tradius = initialRadius;\n    \t// \t\t\t\topacity = initialOpacity;\n    \t// \t\t\t}\n      //\n  \t\t// \t}, 1000 / framesPerSecond);\n      //\n  \t\t// }\n  \t\t// // Start the animation.\n  \t\t// animateMarker(0);\n  \t}\n\n  \t//fly the map to [lat, lng] position\n  \tfunction fly(coordinates) {\n  \t\tmap.flyTo({\n  \t\t\tcenter: coordinates,\n  \t\t\tzoom: 11\n  \t\t});\n  \t}\n\n\t\t$('#showEventsForm').on('click', function(){\n\t \t \tif( $('#eventForm').hasClass('hidden')){\n\t \t\t \t$('#eventForm').animateCss('fadeInDown','', '#event');\n\t \t\t\t$('#solidarischForm').animateCss('zoomOutLeft', 'hidden');\n\n\t \t \t}\n\t \t\telse{\n\t \t\t\t$('#solidarischForm').animateCss('fadeInDown');\n\t  \t\t\t$('#eventForm').animateCss('zoomOutLeft', 'hidden');\n\t  \t \t}\n\n\t \t});\n\t \tvar newImage = null;\n\t \t$(\"#image-upload\").dropzone({\n\t \t\tinit:function(){\n\t \t\t\t this.on(\"success\", function(file) {\n\t \t\t\t\t\tnewImage = JSON.parse(file.xhr.response);\n\t \t\t\t });\n\t \t\t},\n\t \t\tparamName:'image',\n\t \t\tmaxFilesize: 4,\n\t \t\tmultiple:false,\n\t \t\tmaxFiles:1,\n\t \t\taddRemoveLinks:true,\n\t \t\tacceptedFiles:'image/*',\n\t \t\turl: \"/api/images\",\n\t \t\tthumbnailWidth:336,\n\t \t\tthumbnailHeight:150,\n\t \t\tdictRemoveFile:'Bild löschen',\n\t \t\tdictInvalidFileType:'Bilddatei?',\n\t \t\tdictFileTooBig:'Die Datei ist zu groß!',\n\t \t\t// success:function(file){\n\t \t\t// \tconsole.log(JSON.parse(file.xhr.response));\n\t \t\t// }\n\t \t});\n})\n"],"sourceRoot":"/source/"}