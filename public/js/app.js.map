{"version":3,"sources":["main.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["$(function() {\n\n  //define mapbox api\n  mapboxgl.accessToken = 'pk.eyJ1IjoibWFnbm9sbyIsImEiOiJuSFdUYkg4In0.5HOykKk0pNP1N3isfPQGTQ';\n  var newHuman = {\n    name: '',\n    email: '',\n    address: null\n  };\n\n  //setup popup\n  var popup = new mapboxgl.Popup({\n    closeButton: false\n  });\n\n  //setup mapbox gl map\n  var map = new mapboxgl.Map({\n    container: 'wo_map',\n    style: 'mapbox://styles/mapbox/light-v8',\n    center: [16.372801, 48.209272],\n    zoom: 3,\n  });\n\n  //setup GeoJSONSource from local API\n  var url = '/api/pois/humans';\n  var source = new mapboxgl.GeoJSONSource({\n    data: url\n  });\n\n  //setup marker data for humans from lokal api\n  map.on('style.load', function() {\n    map.addSource('peoples', source);\n    map.addLayer({\n      \"id\": \"humans\",\n      \"interactive\": true,\n      \"type\": \"circle\",\n      \"paint\": {\n        \"circle-color\": '#EB5B27',\n        \"circle-radius\": 3\n      },\n      \"source\": \"peoples\",\n    })\n  });\n\n  //open popup for click on human marker\n  map.on('click', function(e) {\n    map.featuresAt(e.point, {\n      radius: 7.5,\n      includeGeometry: true,\n      layer: 'humans'\n    }, function(err, features) {\n      if (err || !features.length) {\n        popup.remove();\n        return;\n      }\n      var feature = features[0];\n      popup.setLngLat(feature.geometry.coordinates)\n        .setHTML(feature.properties.name)\n        .addTo(map);\n    })\n  });\n\n  //validate and submit solidarisch form\n  $('#solidarisch').validate({\n    submitHandler: function(form) {\n      $(form).submit(function(e) {\n        $('#solidarisch .btn').attr('disabled', true);\n        newHuman.name = $('#name').val();\n        newHuman.email = $('#email').val();\n        newHuman.lat = newHuman.address.geometry.coordinates[0];\n        newHuman.lng = newHuman.address.geometry.coordinates[1];\n        $.post('/api/pois/humans', newHuman, function(response) {\n          resetMarker();\n          source.setData(url);\n          $('#solidarisch .btn').removeAttr('disabled');\n          $('#solidarisch')[0].reset();\n        })\n      })\n    }\n  });\n\n  //autocomplete address input with mapzen remote\n  $('#location').autocomplete({\n    serviceUrl: 'https://search.mapzen.com/v1/search',\n    dataType: 'json',\n    paramName: 'text',\n    params: {\n      \"api_key\": \"search-Jssufg0\"\n    },\n    minChars: 3,\n    transformResult: function(response) {\n      return {\n        suggestions: $.map(response.features, function(item) {\n          return {\n            value: item.properties.label,\n            data: item\n          }\n        })\n      }\n    },\n    onSelect: function(suggestion) {\n      newHuman.address = suggestion.data;\n      addMarker(suggestion.data);\n      fly(suggestion.data.geometry.coordinates)\n    }\n  });\n\n  //Map Fly to lat,lng\n  var dynamicMarkerSrc = null;\n  var dynamicMarkerLayer = null;\n\n  function resetMarker() {\n    var lSource = map.getSource('newMarker');\n    if (typeof lSource != \"undefined\") {\n      map.removeLayer('newEntry');\n      map.removeSource('newMarker')\n    }\n  }\n\n  function addMarker(data) {\n    resetMarker();\n    map.addSource('newMarker', {\n      type: 'geojson',\n      data: data\n    });\n    map.addLayer({\n      \"id\": \"newEntry\",\n      \"interactive\": true,\n      \"type\": \"circle\",\n      \"paint\": {\n        \"circle-color\": '#00ff00',\n        \"circle-radius\": 5\n      },\n      \"source\": \"newMarker\",\n    })\n  }\n\n  function fly(coordinates) {\n    map.flyTo({\n      center: coordinates,\n      zoom: 11\n    });\n  }\n\n});"],"sourceRoot":"/source/"}