{"version":3,"sources":["event.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"event.js","sourcesContent":["$(function() {\n  //define variables\n  var eventId = $('#event').data('id');\n  $.datas = {\n    map: null,\n    layer: null,\n    layers: {\n      heat: null,\n      base: null,\n      markers: null\n    },\n    icons: {\n      base: L.divIcon({\n        className: 'baseIcon'\n      }),\n      event: L.icon({\n        iconUrl: '/images/markers/bubble.png',\n        iconSize: [40, 33],\n        iconAnchor: [20, 33],\n        popupAnchor: [0, -20],\n        //shadowUrl: '/images/markers/bubble_shadow.png',\n        //shadowRetinaUrl: 'my-icon-shadow@2x.png',\n        //shadowSize: [40, 33],\n        //shadowAnchor: [20, 33]\n      }),\n      human: L.icon({\n        iconUrl: '/images/markers/ball.png',\n        iconSize: [12, 12],\n        iconAnchor: [6, 6],\n        //popupAnchor: [0, -20],\n        //shadowUrl: 'my-icon-shadow.png',\n        //shadowRetinaUrl: 'my-icon-shadow@2x.png',\n        //shadowSize: [68, 95],\n        //shadowAnchor: [22, 94]\n      })\n    },\n    newPoint: {\n      address: null,\n      marker: null\n    },\n    newImage: null\n  }\n  var newHuman = {\n    name: '',\n    email: '',\n    address: null\n  };\n  var newEvent = {\n    name: '',\n    email: '',\n    address: null\n  };\n\n\n  $.datas.layers.base = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {\n    attribution: 'Tiles &copy; CartoDB'\n  });\n\n  $.datas.map = L.map('wo_map', {\n    layers: [$.datas.layers.base],\n    center: [48.209272, 16.372801],\n    zoom: 12,\n    zoomControl: false,\n    touchZoom: false\n  });\n\n  //Zoom Controls to right\n  new L.Control.Zoom({\n    position: 'topright'\n  }).addTo($.datas.map);\n\n  $.datas.layer = L.Util.ajax(\"/api/pois/\"+eventId).then(function(data) {\n    $.datas.layers.markers = L.geoJson.css(data);\n    $.datas.layers.markers.addTo($.datas.map);\n    $.datas.map.setView([\n      data.features[0].geometry.coordinates[1],\n      data.features[0].geometry.coordinates[0],\n    ]);\n  });\n\n  //\n  $('.map_overlay').on('click', function(e) {\n    $(this).fadeOut(function() {\n      $(this).remove()\n    });\n  });\n\n\n  //FROM STUFF\n\n\n  //validate and submit solidarisch form\n  $('#event_update').validate({\n    errorElement: 'div',\n    errorPlacement: function(error, element) {\n      error.appendTo(element.parent(\".input-field\"));\n    },\n    submitHandler: function(form) {\n\n      newEvent.title = $('#event_title').val();\n      newEvent.address = $.datas.newPoint.address;\n      newEvent.from_date = $('#event_from').val();\n      newEvent.to_date = $('#event_to').val();\n      newEvent.phone = $('#event_phone').val();\n      newEvent.url = $('#event_url').val();\n      newEvent.description = $('#event_description').val();\n      newEvent.lat = $.datas.newPoint.address.geometry.coordinates[0];\n      newEvent.lng = $.datas.newPoint.address.geometry.coordinates[1];\n      if ($.datas.newImage) {\n        newEvent.image_id = $.datas.newImage.id;\n      }\n\n      $('#event .btn').attr('disabled', true);\n      $.post('/api/pois/events', newEvent, function(response) {\n        swal({\n          title: \"Baam!\",\n          text: \"Deine Veranstaltung wurde erfolgreich gespeichert!\",\n          type: \"success\",\n          confirmButtonText: \"Ok!\",\n          confirmButtonColor: \"#EB5B27\"\n        });\n        drawMarker('event', [newEvent.lat, newEvent.lng]);\n        $('#event')[0].reset();\n        $('#event label').removeClass('active');\n        $('#event .btn').removeAttr('disabled');\n        //$(\"#image-upload\").removeAllFiles();\n      }).error(function(response) {\n        if (response.status == 401) {\n          swal({\n            title: \"Nicht erlaubt!\",\n            text: \"Bitte logge dich ein um ein Event zu erstellen!\",\n            type: \"error\",\n            confirmButtonText: \"Ok!\",\n            confirmButtonColor: \"#EB5B27\"\n          });\n        } else {\n          swal({\n            title: \"Ouch!\",\n            text: \"Da ist etwas schiefgelaufen!\",\n            type: \"error\",\n            confirmButtonText: \"Ok!\",\n            confirmButtonColor: \"#EB5B27\"\n          });\n        }\n\n        $('#event .btn').removeAttr('disabled');\n      });\n    }\n  });\n\n\n  //autocomplete address input with mapzen remote\n  $('.location').autocomplete({\n    serviceUrl: 'https://search.mapzen.com/v1/search',\n    dataType: 'json',\n    paramName: 'text',\n    params: {\n      \"api_key\": \"search-Jssufg0\"\n    },\n    minChars: 3,\n    transformResult: function(response) {\n      return {\n        suggestions: $.map(response.features, function(item) {\n          return {\n            value: item.properties.label,\n            data: item\n          }\n        })\n      }\n    },\n    onSelect: function(suggestion) {\n      $.datas.newPoint.address = suggestion.data;\n      var coordinates = suggestion.data.geometry.coordinates;\n      $('#lat').val(coordinates[0]);\n      $('#lng').val(coordinates[1]);\n      $('#location').val(JSON.stringify($.datas.newPoint.address));\n      moveMarker('event', coordinates);\n\n    }\n  });\n\n\n  //define image uploader\n  var uploader = $(\"#image-upload\").dropzone({\n    init: function() {\n      this.on(\"success\", function(file) {\n        $.datas.newImage = JSON.parse(file.xhr.response);\n        $('#image_id').val($.datas.newImage.id);\n      });\n    },\n    paramName: 'image',\n    maxFilesize: 4,\n    multiple: false,\n    maxFiles: 1,\n    addRemoveLinks: true,\n    acceptedFiles: 'image/*',\n    url: \"/api/images\",\n    thumbnailWidth: 336,\n    thumbnailHeight: 150,\n    dictRemoveFile: 'Bild löschen',\n    dictInvalidFileType: 'Bilddatei?',\n    dictFileTooBig: 'Die Datei ist zu groß!',\n\n  });\n\n  $('.timeinput').timepicker({\n    timeFormat: 'H:i'\n  });\n\n\n  function moveMarker(type, coordinates) {\n    if ($.datas.newPoint.marker) {\n      $.datas.newPoint.marker.remove();\n    };\n    $.datas.newPoint.marker = L.marker([coordinates[1], coordinates[0]], {\n      icon: $.datas.icons[type],\n      draggable: true,\n      riseOnHover: true,\n    });\n    $.datas.newPoint.marker.addTo($.datas.map);\n    $.datas.newPoint.marker.on('dragend', function(e) {\n      $.datas.newPoint.address.geometry.coordinates[1] = e.target._latlng.lat;\n      $.datas.newPoint.address.geometry.coordinates[0] = e.target._latlng.lng;\n    });\n    $.datas.map.flyTo([coordinates[1], coordinates[0]], 13);\n  }\n\n});\n"],"sourceRoot":"/source/"}